<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }

        /* canvas {
            margin-left: 350px;
        } */
    </style>
</head>

<body>
    <script>
        const config = {
            backgroundColor: '#FFFFFF',
            type: Phaser.Auto,
            width: 800,
            height: 700,
            scene: {
                preload: preload,
                create: create,
                update: update
            },
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 370 },    ///原本400
                    debug: false
                }
            },
            scale: {
                autoCenter: Phaser.Scale.CENTER_BOTH
            }
        };

        var game = new Phaser.Game(config);

        function preload() {
            this.load.image('bg1', './assets/background.png');
            this.load.image('bg2', './assets/desert.png');
            this.load.image('bg3', './assets/lobby.png');
            this.load.image('gd1', './assets/gd1.png');
            this.load.image('gd2', './assets/gd2.png');
            this.load.image('dland', './assets/land.png');
            this.load.image('dland880', './assets/land1.png');
            this.load.image('dland570', './assets/land2.png');
            this.load.image('dland100', './assets/land_100.png');
            this.load.image('tpt', './assets/tpt_block.png');
            this.load.spritesheet('snake', './assets/snake.png', { frameWidth: 98.8, frameHeight: 45 });
            this.load.image('star', './assets/star.png');
            this.load.image('bomb', './assets/bomb.png');
            this.load.spritesheet('hourse', './assets/hourse1.png', { frameWidth: 80, frameHeight: 117.5 });
            this.load.spritesheet('hourse_dance', './assets/hourse1_dance.png', { frameWidth: 93.5, frameHeight: 118 });
            this.load.image('high_fence', './assets/high_fence.png');
            this.load.image('high_fence1', './assets/high_fence1.png');
            this.load.image('fence', './assets/fence.png');
            this.load.image('fence1', './assets/fence1.png');
            this.load.image('block', './assets/block.png');
            this.load.image('door', './assets/door.png');
            this.load.image('dptf', './assets/dptf.png');
            this.load.image('castle', './assets/castle01.png');
            this.load.image('cts1', './assets/cactus.png');
            this.load.image('cts2', './assets/catus2.png');
            this.load.image('top1', './assets/top.png');
            this.load.image('main_floor1200', './assets/main_floor1200.png');
            this.load.image('main_floor', './assets/main_floor.png');
            this.load.image('black', './assets/black.png');
            this.load.image('black1', './assets/black1.png');
            this.load.image('half_stair', './assets/half_stair.png');
            this.load.image('stair1', './assets/stair1.png');
            this.load.image('stair1_1', './assets/stair1_1.png');
            this.load.image('stair', './assets/stair.png');
            this.load.image('stair_01', './assets/stair_01.png');
            this.load.image('stair_02', './assets/stair_02.png');
            this.load.image('stair_03', './assets/stair_03.png');
            this.load.image('stair_04', './assets/stair_04.png');
            this.load.image('stab1', './assets/stab1.png');
            this.load.image('stab2', './assets/stab2.png');
            this.load.image('again', './assets/again.png');
            this.load.image('finish', './assets/finish.png');
            this.load.image('start', './assets/start.png');
            this.load.image('next', './assets/next.png');
            this.load.image('logo', './assets/logo.png');
            this.load.image('start_teach', './assets/start_teach.png');
            this.load.image('the_end', './assets/the_end.png');
            this.load.spritesheet('rgem', './assets/rgem.png', { frameWidth: 40, frameHeight: 40 });
            this.load.spritesheet('bgem', './assets/bgem.png', { frameWidth: 40, frameHeight: 40 });
            this.load.spritesheet('ogem', './assets/ogem.png', { frameWidth: 40, frameHeight: 40 });
            this.load.spritesheet('ggem', './assets/ggem.png', { frameWidth: 40, frameHeight: 40 });
            this.load.spritesheet('pgem', './assets/pgem.png', { frameWidth: 40, frameHeight: 40 });
            this.load.spritesheet('pbgem', './assets/pbgem.png', { frameWidth: 40, frameHeight: 40 });
            this.load.spritesheet('ygem', './assets/ygem.png', { frameWidth: 40, frameHeight: 40 });
            this.load.spritesheet('meat', './assets/meat.png', { frameWidth: 66, frameHeight: 52 });
            this.load.spritesheet('hourse_attack', './assets/hourse1_attack.png', { frameWidth: 144.055, frameHeight: 117.5 });
            this.load.spritesheet('trap', './assets/trap.png', { frameWidth: 40, frameHeight: 25 });
            this.load.spritesheet('scorp', './assets/scorpion.png', { frameWidth: 74.5, frameHeight: 73 });
            this.load.spritesheet('sand1', './assets/sand.png', { frameWidth: 64, frameHeight: 31 });
            this.load.spritesheet('fire', './assets/fire.png', { frameWidth: 18.6, frameHeight: 49 });
            this.load.spritesheet('farmer', './assets/farmer.png', { frameWidth: 121, frameHeight: 150 });
            this.load.spritesheet('farmer_atk', './assets/farmer_atk.png', { frameWidth: 125, frameHeight: 150 });
            this.load.spritesheet('farmer_black', './assets/farmer_black.png', { frameWidth: 121, frameHeight: 150 });
            this.load.spritesheet('farmer_black_atk', './assets/farmer_black_atk.png', { frameWidth: 125, frameHeight: 150 });
            this.load.spritesheet('rainbowpony', './assets/rainbowpony.png', { frameWidth: 80, frameHeight: 118 });
            this.load.spritesheet('rainbowpony_atk', './assets/rainbowpony_attack.png', { frameWidth: 144.3, frameHeight: 118 });
            this.load.spritesheet('black_hourse', './assets/black_hourse.png', { frameWidth: 142, frameHeight: 157 });
            this.load.spritesheet('black_hourse_atk', './assets/black_hourse_attack.png', { frameWidth: 190, frameHeight: 157 });
            this.load.spritesheet('tpt1', './assets/tpt_block.png', { frameWidth: 20, frameHeight: 700 });
            this.load.audio('animal_trap_close', './assets/sound/animal_trap_close.mp3');
            this.load.audio('horse_hurted', './assets/sound/horse_hurted.mp3');
            this.load.audio('first_round_bgm', './assets/sound/first_round_bgm.mp3');
            this.load.audio('before_game_bgm', './assets/sound/before_game_bgm.mp3');
            this.load.audio('second_round_bgm', './assets/sound/second_round_bgm.mp3');
            this.load.audio('third_round_bgm', './assets/sound/third_round_bgm.mp3');
            this.load.audio('final_bgm', './assets/sound/final_bgm.mp3');
            this.load.audio('get_gem', './assets/sound/get_gem.mp3');
            this.load.audio('get_meat', './assets/sound/get_meat.mp3');
            this.load.audio('monster_die', './assets/sound/monster_die.mp3');
            this.load.audio('boss_weapon_drop', './assets/sound/boss_weapon_drop.mp3');
            this.load.audio('become_black_horse', './assets/sound/become_black_horse.mp3');
            this.load.audio('become_rainbow', './assets/sound/become_rainbow.mp3');
            this.load.audio('go_to_next_round', './assets/sound/go_to_next_round.mp3');
        }
        let finish2 = 0;
        let count3 = 0;
        let clrtint = 0;
        let run = 0;
        let farmer_life = 600;
        let trpon = 0;
        let read = false;
        let count1 = 0;
        let count2 = 0;
        let zoomin = 0;
        let jump = 0; let jump1 = 0; let jump2 = 0;
        let a = 0; let b = 0; let c = 1; let d = 0; let e = 0;
        let score = 0;
        let free = 0;
        let cnt = 0;
        let heart = 5;
        let gem = 0;
        let meat1 = 0;
        let overlapTriggered = false;
        let overlapTriggered1 = false;
        let scoreText;
        let change;
        let weild;
        let platforms;
        let platforms1;
        let cursors;
        let bombs;
        let gameOver = false;
        let finish1 = false;
        let restartText;
        let restartText1;
        let intro;
        let intro2;
        let nextText;
        let click;
        let click1;
        let click2;
        let finish;
        let block;
        let snake; let snake1; let snake2; let snake3; let snake4;
        let trap; let trap1; let trap2; let trap4; let trap5;
        let high_fence; let high_fence1; let fence; let fence1;
        let door;
        let dland;
        let dland100;
        let dland880;
        let tpt; let tpt1;
        let dptf;
        let cts1; let cts2;
        let castle;
        let scorp; let scorp1; let scorp2;
        let sand;
        let top1;
        let main_floor1200;
        let main_floor800;
        let main_floor;
        let fire; let fire1; let fire2; let fire3; let fire4; let fire5; let fire6; let fire7; let fire8;
        let half_stair;
        let stair1;
        let stair;
        let stair1_1;
        let stair_01; let stair_02; let stair_03; let stair_04;
        let stab1; let stab2; let stab3;
        let farmer;
        let animal_trap_close;
        let horse_hurted;
        let first_round_bgm;
        let second_round_bgm;
        let third_round_bgm;
        let final_bgm;
        let before_game_bgm;
        let become_black_horse;
        let become_rainbow;
        let get_gem;
        let get_meat;
        let boss_weapon_drop;
        let monster_die;
        let go_to_next_round;
        let start;
        let logo;

        function create() {
            this.physics.world.setBounds(0, 0, 9300, 700);  //世界範圍
            this.cameras.main.setBounds(0, 0, 9300, 700);   //(相機的位置和能夠延伸的大小範圍)
            //聲音
            animal_trap_close = this.sound.add('animal_trap_close');
            horse_hurted = this.sound.add('horse_hurted');
            get_gem = this.sound.add('get_gem');
            get_meat = this.sound.add('get_meat');
            monster_die = this.sound.add('monster_die').setVolume(5);
            boss_weapon_drop = this.sound.add('boss_weapon_drop').setVolume(5);
            become_black_horse = this.sound.add('become_black_horse').setVolume(2);
            become_rainbow = this.sound.add('become_rainbow').setVolume(2);
            go_to_next_round = this.sound.add('go_to_next_round').setVolume(2);
            first_round_bgm = this.sound.add('first_round_bgm', {
                loop: true
            });
            before_game_bgm = this.sound.add('before_game_bgm', {
                loop: true
            });
            second_round_bgm = this.sound.add('second_round_bgm', {
                loop: true
            });
            third_round_bgm = this.sound.add('third_round_bgm', {
                loop: true
            });
            final_bgm = this.sound.add('final_bgm', {
                loop: true
            });

            const pic = this.add.image(1000, 300, 'bg1');
            const pic0 = this.add.image(3000, 300, 'bg1');
            const pic1 = this.add.image(4000, 300, 'bg2');
            const pic2 = this.add.image(5800, 300, 'bg2');
            const black = this.add.image(6500, 300, 'black');
            const black1 = this.add.image(8300, 300, 'black1');
            const pic3 = this.add.image(8300, 340, 'bg3');
            pic.displayWidth = 2000;
            pic.displayHeight = 700;
            pic1.displayWidth = 2000;
            pic1.displayHeight = 700;
            platforms = this.physics.add.staticGroup();
            platforms1 = this.physics.add.staticGroup();
            block = this.physics.add.staticGroup();
            high_fence = this.physics.add.staticGroup();
            high_fence1 = this.physics.add.staticGroup();
            fence = this.physics.add.staticGroup();
            fence1 = this.physics.add.staticGroup();
            tpt = this.physics.add.staticGroup();
            tpt1 = this.physics.add.staticGroup();
            dland = this.physics.add.staticGroup();
            dland100 = this.physics.add.staticGroup();
            dland570 = this.physics.add.staticGroup();
            dland880 = this.physics.add.staticGroup();
            dptf = this.physics.add.staticGroup();
            cts1 = this.physics.add.staticGroup();
            cts2 = this.physics.add.staticGroup();
            castle = this.physics.add.staticGroup();
            top1 = this.physics.add.staticGroup();
            main_floor = this.physics.add.staticGroup();
            main_floor1200 = this.physics.add.staticGroup();
            main_floor800 = this.physics.add.staticGroup();
            half_stair = this.physics.add.staticGroup();
            stair1 = this.physics.add.staticGroup();
            stab1 = this.physics.add.staticGroup();
            stab2 = this.physics.add.staticGroup();
            stab3 = this.physics.add.staticGroup();
            stair = this.physics.add.staticGroup();
            stair1_1 = this.physics.add.staticGroup();
            stair_01 = this.physics.add.staticGroup();
            stair_02 = this.physics.add.staticGroup();
            stair_03 = this.physics.add.staticGroup();
            stair_04 = this.physics.add.staticGroup();

            ///////////////////////////////////   !  場景搭建   !   /////////////////////////////////////////////
            //////   柵欄   //////
            platforms1.create(1000, 615, 'gd2').setScale(1).refreshBody(); //創造地板(x, y是座標) (setscale是大小)  //2000*73
            tpt.create(2010, 400, 'tpt').setScale(1).refreshBody(); //20*700
            tpt.create(3400, 400, 'tpt').setScale(1).refreshBody(); //20*700
            tpt.create(6100, 400, 'tpt').setScale(1).refreshBody(); //20*700
            high_fence1.create(20, 538.5, 'high_fence1').setScale(1).refreshBody();     //35*77
            high_fence1.create(20, 470, 'high_fence1').setScale(1).refreshBody();     //35*77
            high_fence1.create(20, 401.5, 'high_fence1').setScale(1).refreshBody();     //35*77
            high_fence1.create(20, 290.5, 'high_fence1').setScale(1).refreshBody();     //35*77
            high_fence1.create(562.5, 405.5, 'high_fence1').setScale(1).refreshBody();     //35*77
            high_fence1.create(562.5, 337, 'high_fence1').setScale(1).refreshBody();     //35*77
            high_fence.create(620, 538.5, 'high_fence').setScale(1).refreshBody();      //67*78
            high_fence.create(620, 500, 'high_fence').setScale(1).refreshBody();      //67*78
            high_fence.create(680, 538.5, 'high_fence').setScale(1).refreshBody();      //67*78
            high_fence.create(680, 500, 'high_fence').setScale(1).refreshBody();      //67*78
            fence1.create(1140, 475, 'fence1').setScale(1).refreshBody();      //35*47
            high_fence1.create(1400, 205, 'high_fence1').setScale(0.75).refreshBody();      //26.25 * 57.75
            high_fence1.create(1400, 150, 'high_fence1').setScale(0.75).refreshBody();      //26.25 * 57.75
            high_fence1.create(1780, 375, 'high_fence1').setScale(0.75).refreshBody();      //26.25 * 57.75
            //////   稻草   //////
            block.create(25, 345, 'block').setScale(1).refreshBody();   //125*32
            block.create(137, 345, 'block').setScale(1).refreshBody();   //125*32
            block.create(250, 134, 'block').setScale(1).refreshBody();   //125*32
            block.create(410, 460, 'block').setScale(1).refreshBody();   //125*32
            block.create(522, 460, 'block').setScale(1).refreshBody();   //125*32
            block.create(450, 280, 'block').setScale(1).refreshBody();   //125*32
            block.create(562, 280, 'block').setScale(1).refreshBody();   //125*32
            block.create(674, 280, 'block').setScale(1).refreshBody();   //125*32
            block.create(674, 280, 'block').setScale(1).refreshBody();   //125*32
            block.create(624, 150, 'block').setScale(1).refreshBody();   //125*32
            block.create(736, 150, 'block').setScale(1).refreshBody();   //125*32
            block.create(865, 370, 'block').setScale(1).refreshBody();   //125*32
            block.create(1100, 500, 'block').setScale(1).refreshBody();   //125*32
            block.create(1150, 280, 'block').setScale(1).refreshBody();   //125*32
            block.create(1262, 280, 'block').setScale(1).refreshBody();   //125*32
            block.create(1400, 250, 'block').setScale(1).refreshBody();   //125*32
            block.create(1512, 250, 'block').setScale(1).refreshBody();   //125*32
            block.create(1512, 390, 'block').setScale(1).refreshBody();   //125*32
            block.create(1624, 420, 'block').setScale(1).refreshBody();   //125*32
            block.create(1736, 420, 'block').setScale(1).refreshBody();   //125*32
            block.create(1870, 360, 'block').setScale(1).refreshBody();   //125*32
            block.create(1937, 360, 'block').setScale(1).refreshBody();   //125*32
            //////   蛇   //////
            snake = this.physics.add.sprite(510, 410, 'snake').setScale(0.8);      //98.8 * 45
            snake1 = this.physics.add.sprite(700, 250, 'snake').setScale(0.8);      //98.8 * 45
            snake2 = this.physics.add.sprite(995, 557.5, 'snake').setScale(0.8);      //98.8 * 45
            snake3 = this.physics.add.sprite(1450, 557.5, 'snake').setScale(0.8);      //98.8 * 45
            snake4 = this.physics.add.sprite(1290, 250, 'snake').setScale(0.8);      //98.8 * 45
            snake.setBounce(0);  //設定物理反彈性質(0會黏住,小於1會漸漸減少彈跳,大於1會越彈越高)
            snake.setCollideWorldBounds(true); //設定畫布大小為物理碰撞邊界
            snake1.setBounce(0);
            snake1.setCollideWorldBounds(true);
            snake2.setBounce(0);
            snake2.setCollideWorldBounds(true);
            snake3.setBounce(0);
            snake3.setCollideWorldBounds(true);
            snake4.setBounce(0);
            snake4.setCollideWorldBounds(true);
            //////   陷阱   //////
            trap = this.physics.add.sprite(305, 565, 'trap').setScale(1);      //40 * 25
            trap1 = this.physics.add.sprite(680, 120, 'trap').setScale(1);      //40 * 25
            trap2 = this.physics.add.sprite(1512, 563, 'trap').setScale(1);      //40 * 25
            trap4 = this.physics.add.sprite(1980, 320, 'trap').setScale(1);      //40 * 25
            trap5 = this.physics.add.sprite(1205, 250, 'trap').setScale(1);      //40 * 25
            trap.setBounce(0);
            trap.setCollideWorldBounds(true);
            //////   門    //////
            door = this.physics.add.sprite(1920, 500, 'door').setScale(1.5).refreshBody();      //51 * 65
            door.setBounce(0);
            door.setCollideWorldBounds(true);
            //////  主角馬   //////
            player = this.physics.add.sprite(100, 520, 'hourse').setScale(0.7).setDepth(1); //產生horse物件並設定出現位置 6140 5000
            player.setBounce(0);  //設定物理反彈性質(0會黏住,小於1會漸漸減少彈跳,大於1會越彈越高)
            player.setCollideWorldBounds(true); //設定畫布大小為物理碰撞邊界
            player1 = this.physics.add.sprite(4000, 400, 'rainbowpony').setScale(0.7).setDepth(1);
            player1.disableBody(true, true)
            player1.setBounce(0);
            player1.setCollideWorldBounds(true);
            player2 = this.physics.add.sprite(4000, 400, 'black_hourse').setScale(0.7).setDepth(1);
            player2.disableBody(true, true)
            player2.setBounce(0);
            player2.setCollideWorldBounds(true);

            endinghorse = this.physics.add.sprite(20, 537, 'hourse').setScale(0.7).setDepth(4).setGravityY(-370);
            endinghorse.setVelocityX(160);
            endinghorse.visible = false;
            endinghorse1 = this.physics.add.sprite(20, 537, 'rainbowpony').setScale(0.7).setDepth(4).setGravityY(-370);
            endinghorse1.setVelocityX(160);
            endinghorse1.visible = false;
            endinghorse2 = this.physics.add.sprite(20, 523, 'black_hourse').setScale(0.7).setDepth(4).setGravityY(-370);
            endinghorse2.setVelocityX(160);
            endinghorse2.visible = false;
            //////   寶石    //////
            bgem = this.physics.add.sprite(250, 70, 'bgem').setScale(0.9);      //36 * 36
            bgem.setBounce(0);
            bgem.setCollideWorldBounds(true);
            bgem.body.setGravityY(-370);
            rgem = this.physics.add.sprite(673, 220, 'rgem').setScale(0.9);      //36 * 36
            rgem.setBounce(0);
            rgem.setCollideWorldBounds(true);
            rgem.body.setGravityY(-370);
            ggem = this.physics.add.sprite(1315, 450, 'ggem').setScale(0.9);      //36 * 36
            ggem.setBounce(0);
            ggem.setCollideWorldBounds(true);
            ggem.body.setGravityY(-370);
            ogem = this.physics.add.sprite(1534, 185, 'ogem').setScale(0.9);      //36 * 36
            ogem.setBounce(0);
            ogem.setCollideWorldBounds(true);
            ogem.body.setGravityY(-370);
            //////   肉   //////
            meat = this.physics.add.sprite(650, 565, 'meat').setScale(0.5);      //66 * 52
            meat.setBounce(0);
            meat.setCollideWorldBounds(true);
            meat.body.setGravityY(-370);
            //////   相機   //////
            this.cameras.main.setSize(800, 600);
            this.cameras.main.startFollow(player, false, 0.075, 0.075);  //相機跟著玩家移動


            //////             //////           //////       第二關場景搭建      //////       //////          //////
            //////   沙漠地板   //////
            dland.create(3300, 619, 'dland880').setScale(1).refreshBody();      //880 * 84
            dland880.create(5070, 618, 'dland880').setScale(1).refreshBody();      //880 * 84
            dland100.create(3790, 618, 'dland100').setScale(1).refreshBody().setDepth(1);      //100 * 84
            dland570.create(4125, 618, 'dland570').setScale(1).refreshBody();      //570 * 84
            //////   沙漠小地板  //////
            dptf.create(3575, 150, 'dptf').setScale(0.55).refreshBody();      //287 * 91
            dptf.create(3650, 460, 'dptf').setScale(0.55).refreshBody();      //287 * 91
            dptf.create(3800, 217, 'dptf').setScale(0.55).refreshBody();      //287 * 91
            dptf.create(3925, 360, 'dptf').setScale(0.55).refreshBody();      //287 * 91
            dptf.create(4100, 220, 'dptf').setScale(0.55).refreshBody();      //287 * 91
            dptf.create(4235, 220, 'dptf').setScale(0.55).refreshBody();      //287 * 91
            dptf.create(4175, 450, 'dptf').setScale(0.55).refreshBody();      //287 * 91
            dptf.create(4525, 420, 'dptf').setScale(0.75).refreshBody();      //287 * 91
            //////   流沙   //////
            sand1 = this.physics.add.sprite(3790, 597, 'sand').setScale(1.4).setDepth(2);      //89.6 * 43.4
            //////   城堡    //////
            castle.create(4900, 424, 'castle').setScale(2.5).setDepth(0).refreshBody();      //320 * 320
            //////   仙人掌  //////
            cts1.create(3740, 180, 'cts2').setScale(0.75).refreshBody();      //25.5 * 37.5
            cts1.create(4230, 390, 'cts2').setScale(1.5).refreshBody();      //51 * 75
            cts1.create(4280, 168, 'cts1').setScale(0.75).refreshBody();      //45.75 * 55.5
            cts1.create(4380, 540, 'cts1').setScale(1).refreshBody();      //61 * 74
            cts1.create(4960, 540, 'cts1').setScale(1).refreshBody();      //61 * 74
            cts1.create(3700, 540, 'cts1').setScale(1).refreshBody();      //61 * 74
            //////   蠍子    //////
            scorp = this.physics.add.sprite(3620, 95, 'scorp').setScale(0.8);      //59.6 * 58.4
            scorp.setBounce(0);
            scorp.setCollideWorldBounds(true);
            scorp1 = this.physics.add.sprite(4300, 535, 'scorp').setScale(0.8);      //59.6 * 58.4
            scorp1.setBounce(0);
            scorp1.setCollideWorldBounds(true);
            scorp2 = this.physics.add.sprite(4415, 330, 'scorp').setScale(0.8);      //59.6 * 58.4
            scorp2.setBounce(0);
            scorp2.setCollideWorldBounds(true);
            //////   寶石    //////
            pgem = this.physics.add.sprite(3605, 75, 'pgem').setScale(0.9);      //36 * 36
            pgem.setBounce(0);
            pgem.setCollideWorldBounds(true);
            pgem.body.setGravityY(-370);
            pbgem = this.physics.add.sprite(3920, 530, 'pbgem').setScale(0.9);      //36 * 36
            pbgem.setBounce(0);
            pbgem.setCollideWorldBounds(true);
            pbgem.body.setGravityY(-370);
            ygem = this.physics.add.sprite(4690, 530, 'ygem').setScale(0.9);      //36 * 36
            ygem.setBounce(0);
            ygem.setCollideWorldBounds(true);
            ygem.body.setGravityY(-370);
            //////             //////           //////       第三關場景搭建      //////       //////          //////
            main_floor1200.create(6300, 500, 'main_floor1200').setScale(1).refreshBody();      //1200 * 74
            main_floor.create(7700, 602, 'main_floor').setScale(1).refreshBody().setDepth(1);      //1599 * 74
            main_floor1200.create(8700, 602, 'main_floor1200').setScale(1).refreshBody();      //1200 * 74
            top1.create(6500, 125, 'top1').setScale(1).refreshBody();      //1599 * 53
            top1.create(8100, 75, 'top1').setScale(1).refreshBody();      //1599 * 53
            fire = this.physics.add.sprite(6300, 400, 'fire').setScale(0.8);      //14.88 * 39.2
            fire.alpha = 0;
            fire.setBounce(0);
            fire.setCollideWorldBounds(true);
            fire.body.setGravityY(-370);
            fire1 = this.physics.add.sprite(6575, 400, 'fire').setScale(0.8);      //14.88 * 39.2
            fire1.alpha = 0;
            fire1.setBounce(0);
            fire1.setCollideWorldBounds(true);
            fire1.body.setGravityY(-370);
            fire2 = this.physics.add.sprite(6850, 400, 'fire').setScale(0.8);      //14.88 * 39.2
            fire2.alpha = 0;
            fire2.setBounce(0);
            fire2.setCollideWorldBounds(true);
            fire2.body.setGravityY(-370);
            fire3 = this.physics.add.sprite(7170, 400, 'fire').setScale(0.8);      //14.88 * 39.2
            fire3.alpha = 0;
            fire3.setBounce(0);
            fire3.setCollideWorldBounds(true);
            fire3.body.setGravityY(-370);
            fire4 = this.physics.add.sprite(7779, 415, 'fire').setScale(1);      //18.6 * 49
            fire4.setBounce(0);
            fire4.setCollideWorldBounds(true);
            fire4.body.setGravityY(-370);
            fire5 = this.physics.add.sprite(8082, 413, 'fire').setScale(1);      //18.6 * 49
            fire5.setBounce(0);
            fire5.setCollideWorldBounds(true);
            fire5.body.setGravityY(-370);
            fire6 = this.physics.add.sprite(8447, 413.5, 'fire').setScale(1);      //18.6 * 49
            fire6.setBounce(0);
            fire6.setCollideWorldBounds(true);
            fire6.body.setGravityY(-370);
            fire7 = this.physics.add.sprite(8788, 413.5, 'fire').setScale(1);      //18.6 * 49
            fire7.setBounce(0);
            fire7.setCollideWorldBounds(true);
            fire7.body.setGravityY(-370);
            fire8 = this.physics.add.sprite(9104, 409, 'fire').setScale(1);      //18.6 * 49
            fire8.setBounce(0);
            fire8.setCollideWorldBounds(true);
            fire8.body.setGravityY(-370);
            stair_02.create(6972, 476, 'stair_04').setScale(1).refreshBody();      //145 * 27
            stair_02.create(6992, 500, 'stair_03').setScale(1).refreshBody();      //184 * 27
            stair_02.create(7010, 525, 'stair_02').setScale(1).refreshBody();      //220 * 27
            stair_01.create(7025.5, 552, 'stair_01').setScale(1).refreshBody();      //251 * 27
            stair1.create(7700, 330, 'stair1').setScale(1).refreshBody().setDepth(1);      //428 * 27
            stair1.create(8270, 445, 'stair1').setScale(1).refreshBody().setDepth(1);      //428 * 27
            stair1.create(8788, 330, 'stair1_1').setScale(1).refreshBody().setDepth(1);      //300 * 27
            stair_01.create(9105, 551, 'stair_01').setScale(1).refreshBody().setDepth(1);      //251 * 27
            stair_02.create(9105, 525, 'stair_02').setScale(1).refreshBody().setDepth(1);      //220 * 27
            stair_03.create(9105, 500, 'stair_03').setScale(1).refreshBody().setDepth(1);      //184 * 27
            stair_04.create(9105, 475, 'stair_04').setScale(1).refreshBody().setDepth(1);      //145 * 27
            stab1.create(8082, 570, 'stab1').setScale(0.25).refreshBody();      //83.75 * 48.25
            stab1.create(7542, 318, 'stab1').setScale(0.25).refreshBody();      //83.75 * 48.25
            stab1.create(8268, 434, 'stab1').setScale(0.25).refreshBody();      //83.75 * 48.25
            stab2.create(8640, 368, 'stab2').setScale(-0.25).refreshBody();      //82.25 * 48
            stab3.create(8930, 295, 'stab2').setScale(0.25).refreshBody();      //83.75 * 48
            farmer = this.physics.add.sprite(9100, 409, 'farmer').setScale(0.5).setDepth(1);      //60.5 * 75
            farmer.setBounce(0);
            farmer.setCollideWorldBounds(true);
            tpt1 = this.physics.add.sprite(7300, 400, 'tpt').setScale(1).refreshBody();      //20 * 700
            tpt1.setBounce(0);
            tpt1.setCollideWorldBounds(true);
            tpt1.disableBody(true, true);
            //8635 8940

            //////   動畫設定   //////
            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('hourse', { start: 1, end: 3 }),  //向左走顯示0到3的圖片
                frameRate: 8,  //影格速度
                repeat: 0,  //重複次數(0預設,1重複一次,-1不斷重複)
            });
            this.anims.create({
                key: 'turn',
                frames: [{ key: 'hourse', frame: 4 }],
                frameRate: 20
            });
            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('hourse', { start: 5, end: 7 }),  //向右走顯示5到8的圖片
                frameRate: 7,
                repeat: 0
            });
            this.anims.create({
                key: 'attack_rt',
                frames: this.anims.generateFrameNumbers('hourse_attack', { start: 8, end: 10 }),
                frameRate: 7,
                repeat: 0
            });
            this.anims.create({
                key: 'attack_lt',
                frames: this.anims.generateFrameNumbers('hourse_attack', { start: 2, end: 4 }),
                frameRate: 7,
                repeat: 0
            });
            this.anims.create({
                key: 'dance',
                frames: this.anims.generateFrameNumbers('hourse_dance', { start: 0, end: 7 }),
                frameRate: 7,
                repeat: 0
            });
            this.anims.create({
                key: 'snake_ml',
                frames: this.anims.generateFrameNumbers('snake', { start: 0, end: 1 }),
                frameRate: 6,
                repeat: -1
            });
            this.anims.create({
                key: 'snake_mr',
                frames: this.anims.generateFrameNumbers('snake', { start: 3, end: 4 }),
                frameRate: 6,
                repeat: -1
            });
            this.anims.create({
                key: 'snake_n',
                frames: [{ key: 'snake', frame: 2 }],
                frameRate: 6,
                repeat: 0
            });
            this.anims.create({
                key: 'trap_on',
                frames: this.anims.generateFrameNumbers('trap', { start: 1, end: 0 }),
                frameRate: 10,
                repeat: 0
            });
            this.anims.create({
                key: 'scp_ml',
                frames: this.anims.generateFrameNumbers('scorp', { start: 0, end: 2 }),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'scp_mr',
                frames: this.anims.generateFrameNumbers('scorp', { start: 3, end: 5 }),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'sand1_ply',
                frames: this.anims.generateFrameNumbers('sand1', { start: 0, end: 2 }),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'fire_ply',
                frames: this.anims.generateFrameNumbers('fire', { start: 0, end: 2 }),
                frameRate: 10,
                repeat: -1
            });
            fire_fadein = this.tweens.add({
                targets: fire,
                ease: 'Linear',
                duration: 2000,
                repeat: 0,
                alpha: 1,
                paused: true //一開始不啟用
            });
            fire1_fadein = this.tweens.add({
                targets: fire1,
                ease: 'Linear',
                duration: 2000,
                repeat: 0,
                alpha: 1,
                paused: true //一開始不啟用
            });
            fire2_fadein = this.tweens.add({
                targets: fire2,
                ease: 'Linear',
                duration: 2000,
                repeat: 0,
                alpha: 1,
                paused: true //一開始不啟用
            });
            fire3_fadein = this.tweens.add({
                targets: fire3,
                ease: 'Linear',
                duration: 2000,
                repeat: 0,
                alpha: 1,
                paused: true //一開始不啟用
            });
            this.anims.create({
                key: 'farmer_n',
                frames: [{ key: 'farmer', frame: 5 }],
                frameRate: 20
            });
            this.anims.create({
                key: 'farmer_ml',
                frames: [{ key: 'farmer_atk', frame: 0 }],
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'farmer_mr',
                frames: [{ key: 'farmer_atk', frame: 1 }],
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'farmer_atr',
                frames: [{ key: 'farmer_atk', frame: 1 }],
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'farmer_atl',
                frames: [{ key: 'farmer_atk', frame: 0 }],
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'farmer_black_n',
                frames: [{ key: 'farmer_black', frame: 5 }],
                frameRate: 20
            });
            this.anims.create({
                key: 'farmer_black_ml',
                frames: [{ key: 'farmer_black_atk', frame: 0 }],
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'farmer_black_mr',
                frames: [{ key: 'farmer_black_atk', frame: 1 }],
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'rainbow_n',
                frames: [{ key: 'rainbowpony', frame: 4 }],
                frameRate: 8
            });
            this.anims.create({
                key: 'rainbow_mr',
                frames: this.anims.generateFrameNumbers('rainbowpony', { start: 7, end: 5 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'rainbow_ml',
                frames: this.anims.generateFrameNumbers('rainbowpony', { start: 1, end: 3 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'rainbow_atklt',
                frames: this.anims.generateFrameNumbers('rainbowpony_atk', { start: 2, end: 4 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'rainbow_atkrt',
                frames: this.anims.generateFrameNumbers('rainbowpony_atk', { start: 8, end: 10 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'black_hourse_ml',
                frames: this.anims.generateFrameNumbers('black_hourse', { start: 1, end: 3 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'black_hourse_mr',
                frames: this.anims.generateFrameNumbers('black_hourse', { start: 7, end: 9 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'black_hourse_n',
                frames: this.anims.generateFrameNumbers('black_hourse', { start: 4, end: 6 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'black_hourse_atklt',
                frames: this.anims.generateFrameNumbers('black_hourse_atk', { start: 2, end: 4 }),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'black_hourse_atkrt',
                frames: this.anims.generateFrameNumbers('black_hourse_atk', { start: 8, end: 10 }),
                frameRate: 8,
                repeat: -1
            });


            //////   增加物件和物件的碰撞或重疊  //////
            cursors = this.input.keyboard.createCursorKeys();
            this.physics.add.collider(player, platforms);
            this.physics.add.collider(player, platforms1);
            this.physics.add.collider(player, dland);
            this.physics.add.collider(player, dland570);
            this.physics.add.collider(player, dland880);
            this.physics.add.collider(player, high_fence);
            this.physics.add.collider(player, high_fence1);
            this.physics.add.collider(player, fence);
            this.physics.add.collider(player, fence1);
            this.physics.add.collider(player, block);
            this.physics.add.collider(player, tpt);
            this.physics.add.collider(player, tpt1);
            this.physics.add.collider(player, dptf);
            this.physics.add.collider(player, cts1);
            this.physics.add.collider(player, cts2);

            this.physics.add.collider(player1, main_floor1200, touchcastlefloor, null, this);
            this.physics.add.collider(player1, main_floor800);
            this.physics.add.collider(player1, main_floor);
            this.physics.add.collider(player1, top1);
            this.physics.add.collider(player1, stair_01);
            this.physics.add.collider(player1, stair_02);
            this.physics.add.collider(player1, stair_03);
            this.physics.add.collider(player1, stair_04);
            this.physics.add.collider(player1, stair1);
            this.physics.add.collider(player1, stair);
            this.physics.add.collider(player1, stab1, hitstab1, null, this);
            this.physics.add.collider(player1, stab2, hitstab3, null, this);
            this.physics.add.collider(player1, stab3, hitstab2, null, this);
            this.physics.add.collider(player1, tpt);
            this.physics.add.collider(player1, tpt1);

            this.physics.add.collider(player2, main_floor1200, touchcastlefloor, null, this);
            this.physics.add.collider(player2, main_floor800);
            this.physics.add.collider(player2, main_floor);
            this.physics.add.collider(player2, top1);
            this.physics.add.collider(player2, stair_01);
            this.physics.add.collider(player2, stair_02);
            this.physics.add.collider(player2, stair_03);
            this.physics.add.collider(player2, stair_04);
            this.physics.add.collider(player2, stair1);
            this.physics.add.collider(player2, stair);
            this.physics.add.collider(player2, stab1, hitstab1, null, this);
            this.physics.add.collider(player2, stab2, hitstab3, null, this);
            this.physics.add.collider(player2, stab3, hitstab2, null, this);
            this.physics.add.collider(player2, tpt);
            this.physics.add.collider(player2, tpt1);

            this.physics.add.collider(player, main_floor1200, touchcastlefloor, null, this);
            this.physics.add.collider(player, main_floor800);
            this.physics.add.collider(player, main_floor);
            this.physics.add.collider(player, top1);
            this.physics.add.collider(player, stair_01);
            this.physics.add.collider(player, stair_02);
            this.physics.add.collider(player, stair_03);
            this.physics.add.collider(player, stair_04);
            this.physics.add.collider(player, stair1);
            this.physics.add.collider(player, stair);
            this.physics.add.collider(player, stab1, hitstab1, null, this);
            this.physics.add.collider(player, stab2, hitstab3, null, this);
            this.physics.add.collider(player, stab3, hitstab2, null, this);
            this.physics.add.collider(player, tpt);
            this.physics.add.collider(player, tpt1);

            this.physics.add.collider(snake, platforms1);
            this.physics.add.collider(snake, block);
            this.physics.add.collider(snake1, platforms1);
            this.physics.add.collider(snake1, block);
            this.physics.add.collider(snake2, platforms1);
            this.physics.add.collider(snake2, block);
            this.physics.add.collider(snake3, platforms1);
            this.physics.add.collider(snake3, block);
            this.physics.add.collider(snake4, platforms1);
            this.physics.add.collider(snake4, block);
            this.physics.add.collider(trap1, block);
            this.physics.add.collider(trap4, block);
            this.physics.add.collider(trap5, block);
            this.physics.add.collider(trap, platforms1);
            this.physics.add.collider(trap1, platforms1);
            this.physics.add.collider(trap2, platforms1);
            this.physics.add.collider(trap4, platforms1);
            this.physics.add.collider(trap5, platforms1);
            this.physics.add.collider(door, platforms1);
            this.physics.add.collider(scorp, dptf);
            this.physics.add.collider(scorp1, dland);
            this.physics.add.collider(scorp1, dland570);
            this.physics.add.collider(scorp2, dptf);
            this.physics.add.collider(stair_01, farmer);
            this.physics.add.collider(stair_02, farmer);
            this.physics.add.collider(stair_03, farmer);
            this.physics.add.collider(stair_04, farmer);
            this.physics.add.collider(farmer, main_floor800);
            this.physics.add.collider(farmer, main_floor1200);
            this.physics.add.collider(farmer, main_floor);
            this.physics.add.collider(farmer, top);
            this.physics.add.collider(farmer, top1);
            this.physics.add.collider(farmer, stair1);


            this.physics.add.overlap(player, trap, trapon, null, this);
            this.physics.add.overlap(player, trap1, trapon1, null, this);
            this.physics.add.overlap(player, trap2, trapon2, null, this);
            this.physics.add.overlap(player, trap4, trapon4, null, this);
            this.physics.add.overlap(player, trap5, trapon5, null, this);
            this.physics.add.overlap(player, snake, hitsnake, null, this);
            this.physics.add.overlap(player, snake1, hitsnake1, null, this);
            this.physics.add.overlap(player, snake2, hitsnake2, null, this);
            this.physics.add.overlap(player, snake3, hitsnake3, null, this);
            this.physics.add.overlap(player, snake4, hitsnake4, null, this);
            this.physics.add.overlap(player, snake, atksnake, null, this);
            this.physics.add.overlap(player, snake1, atksnake1, null, this);
            this.physics.add.overlap(player, snake2, atksnake2, null, this);
            this.physics.add.overlap(player, snake3, atksnake3, null, this);
            this.physics.add.overlap(player, snake4, atksnake4, null, this);
            this.physics.add.overlap(player, scorp, hitscorp, null, this);
            this.physics.add.overlap(player, scorp1, hitscorp1, null, this);
            this.physics.add.overlap(player, scorp2, hitscorp2, null, this);
            this.physics.add.overlap(player, scorp, atkscorp, null, this);
            this.physics.add.overlap(player, scorp1, atkscorp1, null, this);
            this.physics.add.overlap(player, scorp2, atkscorp2, null, this);
            this.physics.add.overlap(player, door, gtdst, null, this);
            this.physics.add.overlap(player, castle, gtcst, null, this);
            this.physics.add.overlap(player, dland100, plyrinsand1, null, this);
            this.physics.add.overlap(player, bgem, collectbgem, null, this);
            this.physics.add.overlap(player, rgem, collectrgem, null, this);
            this.physics.add.overlap(player, ggem, collectggem, null, this);
            this.physics.add.overlap(player, pbgem, collectpbgem, null, this);
            this.physics.add.overlap(player, pgem, collectpgem, null, this);
            this.physics.add.overlap(player, ogem, collectogem, null, this);
            this.physics.add.overlap(player, ygem, collectygem, null, this);
            this.physics.add.overlap(player, meat, collectmeat, null, this);
            this.physics.add.overlap(player, farmer, hitfarmer, null, this);
            this.physics.add.overlap(player1, farmer, hitfarmer1, null, this);
            this.physics.add.overlap(player2, farmer, hitfarmer2, null, this);
            this.physics.add.overlap(player, farmer, hourseatk, null, this);
            this.physics.add.overlap(player1, farmer, rainbowatk, null, this);
            this.physics.add.overlap(player2, farmer, blackatk, null, this);
            //this.physics.add.overlap(player, castle, null, this);

            //////   左上角的血量    //////
            scoreText = this.add.text(20, 20, 'Heart：' + heart, { fontSize: '24px', fill: '#000' });
            scoreText.setScrollFactor(0); //文字跟著鏡頭移動
            scoreText1 = this.add.text(20, 20, 'Heart：' + heart, { fontSize: '24px', color: 'white' });
            scoreText1.setScrollFactor(0); //文字跟著鏡頭移動
            scoreText1.visible = false;

            //////   重新開始按鈕   //////
            restartText = this.add.image(config.width / 2, config.height / 2 - 100, 'again').setDepth(4);
            restartText.setScrollFactor(0);
            restartText.visible = false;
            restartText.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                ending.visible = false;
                logo.visible = false;
                if (c == 1) {
                    heart = 5;
                    scoreText.setText('Heart：' + heart);
                    gameOver = false;
                    this.physics.resume();
                    this.scene.restart();
                    restartText.setVisible(false);
                }
                if (c == 2) {
                    heart = 5;
                    scoreText.setText('Heart：' + heart);
                    gameOver = false;
                    this.physics.resume();
                    player.x = 3445.5;
                    player.y = 490;
                    restartText.setVisible(false);
                }
                if (c == 3) {
                    heart = 5;
                    scoreText1.setText('Heart：' + heart);
                    gameOver = false;
                    this.physics.resume();
                    player.x = 7350;
                    player1.x = 7350;
                    player2.x = 7350
                    restartText.setVisible(false);
                }
            })
            //////   ending 和 start背景     //////
            ending = this.add.image(1000, 300, 'bg1').setDepth(4);
            ending.visible = false;
            if (e == 1) {
                ending1 = this.add.image(1000, 300, 'bg1').setDepth(2);
                logo1 = this.add.image(config.width / 2, config.height / 2 - 75, 'logo').setScale(0.25).setDepth(4);
                the_end = this.add.image(config.width / 2, config.height / 2 + 115, 'the_end').setScale(0.6).setDepth(4);
            }

            //////   LOGO  //////
            logo = this.add.image(config.width / 2, config.height / 2 - 110, 'logo').setScale(0.3).setDepth(4);
            logo.setScrollFactor(0);

            //////   開始按鈕  //////
            start = this.add.image(config.width / 2, config.height / 2 + 125, 'start').setScale(0.7).setDepth(4);
            start.setScrollFactor(0);
            start.visible = false;
            logo.visible = false;
            start.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                logo.visible = false;
                start.visible = false;
                intro = this.add.text(100, config.height / 2 - 100, '你是一隻厭倦農場生活而逃脫出來的小馬\n\n\n聽說吃七彩寶石就能變成「彩虹小馬」以獲得自由\n\n\n但農場主人隨時都可能來抓你回去！', {
                    fontSize: '30px 微軟正黑體',
                    color: 'white',
                    stroke: 'red',
                    border: 4
                });
                click1 = this.add.text(600, config.height / 2 + 170, '點擊文字繼續', {
                    fontSize: '15px 微軟正黑體',
                    color: 'white',
                    stroke: 'red',
                    border: 4
                });
                click1.setDepth(5);
                intro.setDepth(5);
                intro.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {                        
                    click1.visible = false;
                    intro2 = this.add.image(config.width / 2, config.height / 2, 'start_teach').setScale(0.2).setDepth(4);
                    intro.visible = false;
                    click2 = this.add.text(600, config.height / 2 + 170, '點擊圖片繼續', {
                        fontSize: '15px 微軟正黑體',
                        color: 'white',
                        stroke: 'red',
                        border: 4
                    });
                    click2.setDepth(5);
                    intro2.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                        intro2.visible = false;
                        click2.visible = false;
                        before_game_bgm.pause();

                        first_round_bgm.play();
                        this.physics.resume();
                        ending.visible = false;
                    });
                });



            })

            //////   下一關的按鈕   //////
            nextText = this.add.image(config.width / 2, config.height / 2 - 100, 'next').setDepth(4);
            nextText.setScrollFactor(0);
            nextText.visible = false;
            nextText.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                go_to_next_round.play();
                first_round_bgm.pause();
                second_round_bgm.play();
                nextText.visible = false;
                this.physics.resume();
                player.x = 3445.5;
                player.y -= 5
                heart = 5;
                scoreText.setText('Heart：' + heart);
                player.body.gravity.y = -25;
                c++;
            })

            nextText1 = this.add.image(config.width / 2, config.height / 2 - 100, 'next').setDepth(4);
            nextText1.setScrollFactor(0);
            nextText1.visible = false;
            nextText1.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                go_to_next_round.play();
                second_round_bgm.pause();
                nextText1.visible = false;
                this.physics.resume();
                c++
                player.x = 6138;
                player.y = 420;
                player1.x = 6138;
                player1.y = 420;
                player2.x = 6138;
                player2.y = 400;
                heart = 5;
                scoreText.visible = false;
                scoreText1.visible = true;
                scoreText1.setText('Heart：' + heart);
                if ((gem <= 7 && gem > 0 && meat1 <= 0) || meat1 >= 1) {
                    change = this.add.text(310, config.height / 2 + 120, '身體好像怪怪的', {
                        fontSize: '25px 微軟正黑體',
                        color: 'white',
                        stroke: 'red',
                        border: 4
                    });
                    click = this.add.text(507, config.height / 2 + 130, '點擊文字繼續', {
                        fontSize: '15px 微軟正黑體',
                        color: 'white',
                        stroke: 'red',
                        border: 4
                    });
                    click.visible = true;
                    change.visible = true;
                    click.setScrollFactor(0);
                    change.setScrollFactor(0);
                    this.physics.pause();
                    change.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                        third_round_bgm.play();
                        if (gem <= 7 && gem > 0 && meat1 <= 0) {
                            this.cameras.main.startFollow(player1, false, 0.075, 0.075);  //相機跟著玩家移動
                            player.disableBody(true, true);
                            player2.disableBody(true, true);
                            player1.enableBody(true, 6138, 420, true, true);
                            change.visible = false;
                            click.visible = false;
                            this.physics.resume();
                            this.cameras.main.flash();
                            become_rainbow.play();
                            a = 1;
                        }
                        else if (meat1 >= 1) {
                            this.cameras.main.startFollow(player2, false, 0.075, 0.075);  //相機跟著玩家移動
                            player.disableBody(true, true);
                            player1.disableBody(true, true);
                            player2.enableBody(true, 6138, 410, true, true);
                            change.visible = false;
                            click.visible = false;
                            this.physics.resume();
                            this.cameras.main.flash();
                            become_black_horse.play();
                            a = 2;
                        }
                        else {
                            player1.disableBody(true, true);
                            player2.disableBody(true, true);
                            this.physics.resume();
                            this.cameras.main.flash();
                            change.visible = false;
                            click.visible = false;
                            this.cameras.main.startFollow(player, false, 0.075, 0.075);  //相機跟著玩家移動
                        }
                    })
                }
                else {
                    third_round_bgm.play();
                }
            })
            //////   結束   //////
            finish = this.add.image(config.width / 2, config.height / 2 - 100, 'finish').setDepth(4);
            finish.setScrollFactor(0).setDepth(1);
            finish.visible = false;
            finish.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                e = 1;
                third_round_bgm.pause();
                final_bgm.play();
                ending.setVisible(true);
                farmer.disableBody(true, true);
                this.scene.restart();
                farmer_life = 600;
                finish1 = false;
                finish.visible = false;
                this.physics.resume();
                finish2 = 1;
            });
        }


        ////////         Funtion專區         ////////
        function gtdst(player, door) {
            nextText.setVisible(true);
            this.physics.pause();
        }

        function gtcst(player, castle) {
            nextText1.setVisible(true);
            this.physics.pause();
        }

        function collectbgem(player, bgem) {
            get_gem.play();
            bgem.disableBody(true, true);
            gem++;
        }
        function collectrgem(player, rgem) {
            get_gem.play();
            rgem.disableBody(true, true);
            gem++;
        }
        function collectggem(player, ggem) {
            get_gem.play();
            ggem.disableBody(true, true);
            gem++;
        }
        function collectpgem(player, pgem) {
            get_gem.play();
            pgem.disableBody(true, true);
            gem++;
        }
        function collectpbgem(player, pbgem) {
            get_gem.play();
            pbgem.disableBody(true, true);
            gem++;
        }
        function collectogem(player, ogem) {
            get_gem.play();
            ogem.disableBody(true, true);
            gem++;
        }
        function collectygem(player, ygem) {
            get_gem.play();
            ygem.disableBody(true, true);
            gem++;
        }
        function collectmeat(player, meat) {
            this.physics.pause();
            get_meat.play();
            meat.disableBody(true, true);
            meat1++;
            weild = this.add.text(270, config.height / 2 + 140, '噁...好像吃到什麼奇怪的東西', {
                fontSize: '25px 微軟正黑體',
                color: 'white',
                stroke: 'red',
                border: 4
            });
            weild.setScrollFactor(0);
            weild.setInteractive().on('pointerdown', (pointer, localX, localY, event) => {
                weild.visible = false;
                click1.visible = false
                this.physics.resume();
            });
            click1 = this.add.text(370, config.height / 2 + 170, '點擊文字繼續', {
                fontSize: '15px 微軟正黑體',
                color: 'white',
                stroke: 'red',
                border: 4
            });
            click1.setScrollFactor(0);
        }

        function hitsnake(player, snake) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }

        }
        function hitsnake1(player, snake1) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }
        }
        function hitsnake2(player, snake2) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }
        }
        function hitsnake3(player, snake3) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }
        }
        function hitsnake4(player, snake4) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }
        }

        function hitscorp(player, scorp) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }
        }

        function hitscorp1(player, scorp1) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }
        }

        function hitscorp2(player, scorp2) {          //碰到怪物扣血
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText.setText('Heart：' + heart);
            }
        }


        function trapon(player, trap) {
            trpon++;
            if (free == 245) {
                trpon = 0;
            }
            if (trpon == 10) {
                animal_trap_close.play();
            }
            cnt = 1;
            player.body.gravity.y = 500;
            trap.anims.play('trap_on');
            trap.setPosition(player.x, (player.y + 25));
            if (cursors.left.isDown || cursors.right.isDown) {
                free++;
            }
            if (free == 250) {
                player.body.gravity.y = 0;
                cnt = 0;
                trap.disableBody(true, true);
                free = 0;
            }
        }
        function trapon1(player, trap1) {
            trpon++;
            if (free == 245) {
                trpon = 0;
            }
            if (trpon == 10) {
                animal_trap_close.play();
            }
            cnt = 1;
            player.body.gravity.y = 500;
            trap1.anims.play('trap_on');
            trap1.setPosition(player.x, (player.y + 25));
            if (cursors.left.isDown || cursors.right.isDown) {
                free++;
            }
            if (free == 250) {
                player.body.gravity.y = 0;
                cnt = 0;
                trap1.disableBody(true, true);
                free = 0;
            }
        }
        function trapon2(player, trap2) {
            trpon++;
            if (free == 245) {
                trpon = 0;
            }
            if (trpon == 10) {
                animal_trap_close.play();
            }
            cnt = 1;
            player.body.gravity.y = 500;
            trap2.anims.play('trap_on');
            trap2.setPosition(player.x, (player.y + 25));
            if (cursors.left.isDown || cursors.right.isDown) {
                free++;
            }
            if (free == 250) {
                player.body.gravity.y = 0;
                cnt = 0;
                trap2.disableBody(true, true);
                free = 0;
            }
        }
        function trapon4(player, trap4) {
            trpon++;
            if (free == 245) {
                trpon = 0;
            }
            if (trpon == 10) {
                animal_trap_close.play();
            }
            cnt = 1;
            player.body.gravity.y = 500;
            trap4.anims.play('trap_on');
            trap4.setPosition(player.x, (player.y + 25));
            if (cursors.left.isDown || cursors.right.isDown) {
                free++;
            }
            if (free == 250) {
                player.body.gravity.y = 0;
                cnt = 0;
                trap4.disableBody(true, true);
                free = 0;
            }
        }
        function trapon5(player, trap5) {
            trpon++;
            if (free == 245) {
                trpon = 0;
            }
            if (trpon == 10) {
                animal_trap_close.play();
            }
            cnt = 1;
            player.body.gravity.y = 500;
            trap5.anims.play('trap_on');
            trap5.setPosition(player.x, (player.y + 25));
            if (cursors.left.isDown || cursors.right.isDown) {
                free++;
            }
            if (free == 250) {
                player.body.gravity.y = 0;
                cnt = 0;
                trap5.disableBody(true, true);
                free = 0;
            }
        }

        function atksnake(player, snake) {
            if ((snake.body.touching.left || snake.body.touching.right || snake.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                snake.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }
        function atksnake1(player, snake1) {
            if ((snake1.body.touching.left || snake1.body.touching.right || snake1.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                snake1.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }
        function atksnake2(player, snake2) {
            if ((snake2.body.touching.left || snake2.body.touching.right || snake2.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                snake2.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }
        function atksnake3(player, snake) {
            if ((snake3.body.touching.left || snake3.body.touching.right || snake3.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                snake3.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }
        function atksnake4(player, snake) {
            if ((snake4.body.touching.left || snake4.body.touching.right || snake4.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                snake4.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }

        function atkscorp(player, scorp) {
            if ((scorp.body.touching.left || scorp.body.touching.right || scorp.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                scorp.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }
        function atkscorp1(player, scorp1) {
            if ((scorp1.body.touching.left || scorp1.body.touching.right || scorp1.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                scorp1.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }
        function atkscorp2(player, scorp2) {
            if ((scorp2.body.touching.left || scorp2.body.touching.right || scorp2.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                scorp2.disableBody(true, true);
                monster_die.play();
                player.clearTint();
            }
        }
        function hourseatk(player, farmer) {
            if ((farmer.body.touching.left || farmer.body.touching.right || farmer.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                farmer_life--;
                if (farmer_life <= 20 && b == 0) {
                    farmer_life = 600;
                    b = 1;
                }
                if (farmer_life == 0) {
                    farmer.disableBody(true, true);
                    boss_weapon_drop.play();
                }
                player.clearTint();
            }
        }
        function rainbowatk(player1, farmer) {
            if ((farmer.body.touching.left || farmer.body.touching.right || farmer.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                farmer_life -= 2;
                if (farmer_life <= 20 && b == 0) {
                    farmer_life = 600;
                    b = 1;
                }
                if (farmer_life == 0) {
                    farmer.disableBody(true, true);
                }
            }
        }
        function blackatk(player2, farmer) {
            if ((farmer.body.touching.left || farmer.body.touching.right || farmer.body.touching.up) && (cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                farmer_life -= 4;
                if (farmer_life <= 20 && b == 0) {
                    farmer_life = 600;
                    b = 1;
                }
                if (farmer_life == 0) {
                    farmer.disableBody(true, true);
                }
            }
        }
        function plyrinsand1(player, dland100) {
            player.setVelocityY(100)
        }
        function touchcastlefloor(player, main_floor1200) {
            fire.anims.play('fire_ply', true);
            fire1.anims.play('fire_ply', true);
            fire2.anims.play('fire_ply', true);
            fire3.anims.play('fire_ply', true);
        }

        function hitstab1(player, stab1) {
            player.setVelocityY(-300);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
                horse_hurted.pause();
                farmer.setTint(0xff0000);
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText1.setText('Heart：' + heart);
            }
        }
        function hitstab2(player, stab2) {
            player.setVelocityY(-300);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
                horse_hurted.pause();
                farmer.setTint(0xff0000);
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText1.setText('Heart：' + heart);
            }
        }
        function hitstab3(player, stab3) {
            player.setVelocityY(400);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
                horse_hurted.pause();
                farmer.setTint(0xff0000);
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText1.setText('Heart：' + heart);
            }
        }

        function hitfarmer(player, farmer) {
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
                horse_hurted.pause();
                farmer.setTint(0xff0000);
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText1.setText('Heart：' + heart);
            }
        }
        function hitfarmer1(player1, farmer) {
            player.setTint(0xff0000);
            if (clrtint == 0 || clrtint == 50) {
                horse_hurted.play();
            }
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
                horse_hurted.pause();
                farmer.setTint(0xff0000);
            }
            if (heart == 5 && overlapTriggered == false) {
                heart = 4;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 4 && overlapTriggered == false) {
                heart = 3;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 3 && overlapTriggered == false) {
                heart = 2;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 2 && overlapTriggered == false) {
                heart = 1;
                scoreText1.setText('Heart：' + heart);
                overlapTriggered = true;
            } else if (heart == 1 && overlapTriggered == false) {
                heart = 0;
                scoreText1.setText('Heart：' + heart);
            }
        }
        function hitfarmer2(player2, farmer) {
            if ((cursors.right.isDown || cursors.left.isDown) && cursors.space.isDown) {
                overlapTriggered = true;
                horse_hurted.pause();
                farmer.setTint(0xff0000);
            }
        }

        function update() {

            console.log();
            d++;
            if (d == 1) {
                before_game_bgm.play();
                this.physics.pause();
                start.setVisible(true);
                ending.visible = true;
                logo.visible = true;
            }

            clrtint++;
            if (clrtint == 50) {
                clrtint = 0;
                player.clearTint();
                farmer.clearTint();
                overlapTriggered = false;
                overlapTriggered1 = false;
                read = false;
                count3 = 0;
            }

            if (farmer_life == 0) {
                finish1 = true;
            }

            if (heart > 0) {
                sand1.anims.play('sand1_ply', true);
            }

            sand1.y = 590;
            sand1.setVelocityY(10);

            if (heart == 0 || player.y > 600) {
                gameOver = true;
            }

            if ((player1.x > 6170 && player1.x <= 6172) || (player.x > 6170 && player.x <= 6172) || (player2.x > 6170 && player2.x <= 6172)) {
                fire_fadein.play();
            }
            if ((player1.x > 6450 && player1.x <= 6452) || (player.x > 6450 && player.x <= 6452) || (player2.x > 6450 && player2.x <= 6452)) {
                fire1_fadein.play();
            }
            if ((player1.x > 6700 && player1.x <= 6703) || (player.x > 6700 && player.x <= 6703) || (player2.x > 6700 && player2.x <= 6703)) {
                fire2_fadein.play();
            }
            if ((player1.x > 6970 && player1.x <= 6972) || (player.x > 6970 && player.x <= 6972) || (player2.x > 6970 && player2.x <= 6972)) {
                fire3_fadein.play();
            }

            if (player1.x > 7300 || player.x > 7300 || player2.x > 7300) {
                fire4.anims.play('fire_ply', true);
                fire5.anims.play('fire_ply', true);
                fire6.anims.play('fire_ply', true);
                fire7.anims.play('fire_ply', true);
                fire8.anims.play('fire_ply', true);
            }
            if (b == 0) {
                farmer.anims.play('farmer_n');
            }
            else if (b == 1) {
                farmer.anims.play('farmer_black_n');
            }

            if ((player1.x >= 7410 && player1.x <= 7415) || (player.x >= 7410 && player.x <= 7415) || (player2.x >= 7410 && player2.x <= 7415)) {
                count1++;
            }
            if (count1 == 1) {
                const cam = this.cameras.main;
                cam.pan(9000, 450, 4000, 'Sine.easeInOut').zoomTo(1, 4000);
            }
            if (player1.x > 7410 || player.x > 7410 || player2.x > 7410) {
                zoomin++;
            }

            if (player1.x >= 7300 || player.x >= 7300 || player2.x >= 7300) {
                tpt1.enableBody(true, 7300, 400, true, true);
            }

            if (zoomin >= 200) {

                if (!player.body.touching.down) {
                    jump++;
                }
                if (!player1.body.touching.down) {
                    jump1++;
                }
                if (!player2.body.touching.down) {
                    jump2++;
                }

                if (player.body.touching.down) {
                    jump = 0;
                }
                if (player1.body.touching.down) {
                    jump1 = 0;
                }
                if (player2.body.touching.down) {
                    jump2 = 0;
                }

                if (a == 0) {
                    if (farmer.x >= player.x + 20) {
                        farmer.setVelocityX(-110);
                        farmer.anims.play('farmer_ml', true);
                    }
                    else if (farmer.x <= player.x - 20) {
                        farmer.setVelocityX(110);
                        farmer.anims.play('farmer_mr', true);
                    }
                }

                if (jump == 60 || jump1 == 60 || jump2 == 60) {
                    farmer.setVelocityY(-330);
                }
                if (a == 1) {
                    if (farmer.x >= player1.x + 20) {
                        farmer.setVelocityX(-110);
                        farmer.anims.play('farmer_ml', true);
                    }
                    else if (farmer.x <= player1.x - 20) {
                        farmer.setVelocityX(110);
                        farmer.anims.play('farmer_mr', true);
                    }
                }


                if (a == 2) {
                    if (farmer.x >= player2.x + 20) {
                        farmer.setVelocityX(-110);
                        farmer.anims.play('farmer_ml', true);
                    }
                    else if (farmer.x <= player2.x - 20) {
                        farmer.setVelocityX(110);
                        farmer.anims.play('farmer_mr', true);
                    }
                }
                if (b == 1) {
                    if (a == 0) {
                        if (farmer.x >= player.x + 20) {
                            farmer.setVelocityX(-130);
                            farmer.anims.play('farmer_black_ml', true);
                        }
                        else if (farmer.x <= player.x - 20) {
                            farmer.setVelocityX(130);
                            farmer.anims.play('farmer_black_mr', true);
                        }
                    }

                    if (jump == 60 || jump1 == 60 || jump2 == 60) {
                        farmer.setVelocityY(-330);
                    }
                    if (a == 1) {
                        if (farmer.x >= player1.x + 20) {
                            farmer.setVelocityX(-130);
                            farmer.anims.play('farmer_black_ml', true);
                        }
                        else if (farmer.x <= player1.x - 20) {
                            farmer.setVelocityX(130);
                            farmer.anims.play('farmer_black_mr', true);
                        }
                    }


                    if (a == 2) {
                        if (farmer.x >= player2.x + 20) {
                            farmer.setVelocityX(-130);
                            farmer.anims.play('farmer_black_ml', true);
                        }
                        else if (farmer.x <= player2.x - 20) {
                            farmer.setVelocityX(130);
                            farmer.anims.play('farmer_black_mr', true);
                        }
                    }
                }
            }




            if (scorp.x >= 3620) {       //控制蠍子轉向動畫
                scorp.setVelocityX(-50);
                scorp.anims.play('scp_ml', true);
            } else if (scorp.x <= 3520) {
                scorp.setVelocityX(50);
                scorp.anims.play('scp_mr', true);
            }
            if (scorp1.x >= 4300) {       //控制蠍子轉向動畫
                scorp1.setVelocityX(-50);
                scorp1.anims.play('scp_ml', true);
            } else if (scorp1.x <= 4000) {
                scorp1.setVelocityX(50);
                scorp1.anims.play('scp_mr', true);
            }
            if (scorp2.x >= 4600) {       //控制蠍子轉向動畫
                scorp2.setVelocityX(-50);
                scorp2.anims.play('scp_ml', true);
            } else if (scorp2.x <= 4435) {
                scorp2.setVelocityX(50);
                scorp2.anims.play('scp_mr', true);
            }



            if (snake.x >= 510) {       //控制蛇轉向動畫
                snake.setVelocityX(-50);
                snake.anims.play('snake_ml', true);
            } else if (snake.x <= 375) {
                snake.setVelocityX(50);
                snake.anims.play('snake_mr', true);
            }

            if (snake1.x >= 700) {       //控制蛇轉向動畫
                snake1.setVelocityX(-50);
                snake1.anims.play('snake_ml', true);
            } else if (snake1.x <= 425) {
                snake1.setVelocityX(50);
                snake1.anims.play('snake_mr', true);
            }
            if (snake2.x >= 995) {       //控制蛇轉向動畫
                snake2.setVelocityX(-50);
                snake2.anims.play('snake_ml', true);
            } else if (snake2.x <= 750) {
                snake2.setVelocityX(50);
                snake2.anims.play('snake_mr', true);
            }
            if (snake3.x >= 1420) {       //控制蛇轉向動畫
                snake3.setVelocityX(-50);
                snake3.anims.play('snake_ml', true);
            } else if (snake3.x <= 1200) {
                snake3.setVelocityX(50);
                snake3.anims.play('snake_mr', true);
            }
            if (snake4.x >= 1290) {       //控制蛇轉向動畫
                snake4.setVelocityX(-50);
                snake4.anims.play('snake_ml', true);
            } else if (snake4.x <= 1120) {
                snake4.setVelocityX(50);
                snake4.anims.play('snake_mr', true);
            }


            if (cursors.left.isDown && cursors.space.isDown) {
                if (cnt == 1) {
                    player.setVelocityX(-60);
                    player.anims.play('attack_lt', true);
                } else {
                    player.setVelocityX(-160);
                    player.anims.play('attack_lt', true);
                }
            } else if (cursors.left.isDown) {
                if (cnt == 1) {
                    player.setVelocityX(-60);
                    player.anims.play('left', true);
                } else {
                    player.setVelocityX(-160);
                    player.anims.play('left', true);
                }
            } else if (cursors.right.isDown && cursors.space.isDown) {
                if (cnt == 1) {
                    player.setVelocityX(60);
                    player.anims.play('attack_rt', true);
                } else {
                    player.setVelocityX(160);
                    player.anims.play('attack_rt', true);
                }
            } else if (cursors.right.isDown) {
                if (cnt == 1) {
                    player.setVelocityX(60);
                    player.anims.play('right', true);
                } else {
                    player.setVelocityX(160);
                    player.anims.play('right', true);
                }
            } else if (cursors.shift.isDown) {
                player.anims.play('dance', true);
            } else {
                player.setVelocityX(0);
                player.anims.play('turn');
            }
            if (cursors.up.isDown && player.body.touching.down) {
                player.setVelocityY(-330);
            }



            if (cursors.left.isDown && cursors.space.isDown) {
                if (cnt == 1) {
                    player1.setVelocityX(-60);
                    player1.anims.play('rainbow_atklt', true);
                } else {
                    player1.setVelocityX(-160);
                    player1.anims.play('rainbow_atklt', true);
                }
            } else if (cursors.left.isDown) {
                if (cnt == 1) {
                    player1.setVelocityX(-60);
                    player1.anims.play('rainbow_ml', true);
                } else {
                    player1.setVelocityX(-160);
                    player1.anims.play('rainbow_ml', true);
                }
            } else if (cursors.right.isDown && cursors.space.isDown) {
                if (cnt == 1) {
                    player1.setVelocityX(60);
                    player1.anims.play('rainbow_atkrt', true);
                } else {
                    player1.setVelocityX(160);
                    player1.anims.play('rainbow_atkrt', true);
                }
            } else if (cursors.right.isDown) {
                if (cnt == 1) {
                    player1.setVelocityX(60);
                    player1.anims.play('rainbow_mr', true);
                } else {
                    player1.setVelocityX(160);
                    player1.anims.play('rainbow_mr', true);
                }
            } else {
                player1.setVelocityX(0);
                player1.anims.play('rainbow_n');
            }
            if (cursors.up.isDown && player1.body.touching.down) {
                player1.setVelocityY(-330);
            }

            if (cursors.left.isDown && cursors.space.isDown) {
                if (cnt == 1) {
                    player2.setVelocityX(-60);
                    player2.anims.play('black_hourse_atklt', true);
                } else {
                    player2.setVelocityX(-160);
                    player2.anims.play('black_hourse_atklt', true);
                }
            } else if (cursors.left.isDown) {
                if (cnt == 1) {
                    player2.setVelocityX(-60);
                    player2.anims.play('black_hourse_ml', true);
                } else {
                    player2.setVelocityX(-160);
                    player2.anims.play('black_hourse_ml', true);
                }
            } else if (cursors.right.isDown && cursors.space.isDown) {
                if (cnt == 1) {
                    player2.setVelocityX(60);
                    player2.anims.play('black_hourse_atkrt', true);
                } else {
                    player2.setVelocityX(160);
                    player2.anims.play('black_hourse_atkrt', true);
                }
            } else if (cursors.right.isDown) {
                if (cnt == 1) {
                    player2.setVelocityX(60);
                    player2.anims.play('black_hourse_mr', true);
                } else {
                    player2.setVelocityX(160);
                    player2.anims.play('black_hourse_mr', true);
                }
            } else {
                player2.setVelocityX(0);
                player2.anims.play('black_hourse_n', true);
            }
            if (cursors.up.isDown && player2.body.touching.down) {
                player2.setVelocityY(-330);
            }

            if (gameOver) {
                this.physics.pause();
                restartText.setVisible(true);
            }

            if (finish1) {
                this.physics.pause();
                finish.setVisible(true);
            }

            if (endinghorse.x >= 850) {
                endinghorse.disableBody(true, true);
            }
            else if (endinghorse1.x >= 850) {
                endinghorse1.disableBody(true, true);
            }
            else if (endinghorse2.x >= 850) {
                endinghorse2.disableBody(true, true);
            }
            if (finish2 == 1) {
                if (a == 1) {
                    endinghorse1.anims.play('rainbow_mr', true);
                    endinghorse1.visible = true;
                }
                else if (a == 2) {
                    endinghorse2.anims.play('black_hourse_mr', true);
                    endinghorse2.visible = true;
                }
                else {
                    endinghorse.anims.play('right', true);
                    endinghorse.visible = true;
                }
            }

        }
    </script>
</body>

</html>